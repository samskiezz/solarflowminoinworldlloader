<!DOCTYPE html>
<html>
<head>
    <title>3D Realm Test</title>
    <style>
        body { background: #000; color: #fff; font-family: monospace; padding: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #333; }
        .pass { border-color: #0f0; background: rgba(0,255,0,0.1); }
        .fail { border-color: #f00; background: rgba(255,0,0,0.1); }
        .btn { 
            background: #333; 
            border: 1px solid #666; 
            color: #fff; 
            padding: 10px 20px; 
            margin: 10px; 
            cursor: pointer; 
        }
        .btn:hover { background: #555; }
    </style>
</head>
<body>
    <h1>3D Realm Compatibility Test</h1>
    
    <div id="webgl-test" class="test">
        <strong>WebGL Support:</strong> <span id="webgl-result">Testing...</span>
    </div>
    
    <div id="three-test" class="test">
        <strong>Three.js Loading:</strong> <span id="three-result">Testing...</span>
    </div>
    
    <div id="canvas-test" class="test">
        <strong>Canvas Rendering:</strong> <span id="canvas-result">Testing...</span>
    </div>
    
    <div id="data-test" class="test">
        <strong>Data Loading:</strong> <span id="data-result">Testing...</span>
    </div>
    
    <div>
        <button class="btn" onclick="runTests()">Run Tests</button>
        <button class="btn" onclick="location.href='realm-fixed.html'">Launch 3D Realm</button>
        <button class="btn" onclick="location.href='index.html'">← Back</button>
    </div>

    <div id="error-log"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        function log(msg) {
            console.log(msg);
            document.getElementById('error-log').innerHTML += '<div style="margin:5px;padding:5px;background:#333;font-size:11px;">' + msg + '</div>';
        }

        function testWebGL() {
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (gl) {
                    document.getElementById('webgl-result').textContent = 'PASS - WebGL supported';
                    document.getElementById('webgl-test').className = 'test pass';
                    return true;
                } else {
                    document.getElementById('webgl-result').textContent = 'FAIL - WebGL not supported';
                    document.getElementById('webgl-test').className = 'test fail';
                    return false;
                }
            } catch (e) {
                document.getElementById('webgl-result').textContent = 'FAIL - ' + e.message;
                document.getElementById('webgl-test').className = 'test fail';
                return false;
            }
        }

        function testThreeJS() {
            try {
                if (typeof THREE !== 'undefined') {
                    const scene = new THREE.Scene();
                    const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
                    document.getElementById('three-result').textContent = 'PASS - Three.js loaded v' + THREE.REVISION;
                    document.getElementById('three-test').className = 'test pass';
                    return true;
                } else {
                    document.getElementById('three-result').textContent = 'FAIL - Three.js not loaded';
                    document.getElementById('three-test').className = 'test fail';
                    return false;
                }
            } catch (e) {
                document.getElementById('three-result').textContent = 'FAIL - ' + e.message;
                document.getElementById('three-test').className = 'test fail';
                return false;
            }
        }

        function testCanvas() {
            try {
                const canvas = document.createElement('canvas');
                canvas.width = 100;
                canvas.height = 100;
                const renderer = new THREE.WebGLRenderer({ canvas: canvas });
                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(75, 1, 0.1, 1000);
                renderer.render(scene, camera);
                
                document.getElementById('canvas-result').textContent = 'PASS - Canvas rendering works';
                document.getElementById('canvas-test').className = 'test pass';
                return true;
            } catch (e) {
                document.getElementById('canvas-result').textContent = 'FAIL - ' + e.message;
                document.getElementById('canvas-test').className = 'test fail';
                return false;
            }
        }

        async function testData() {
            try {
                // Test if we can load minion data
                let response = await fetch('hive_state.json?' + Date.now());
                let minionRoster = [];
                
                if (response.ok) {
                    const hiveData = await response.json();
                    minionRoster = hiveData.minions?.roster || [];
                }
                
                if (minionRoster.length === 0) {
                    // Try fallback
                    response = await fetch('minions.json?' + Date.now());
                    if (response.ok) {
                        const fallbackData = await response.json();
                        minionRoster = fallbackData.minions || [];
                    }
                }
                
                if (minionRoster.length > 0) {
                    document.getElementById('data-result').textContent = `PASS - ${minionRoster.length} minions from hive_state.json`;
                    document.getElementById('data-test').className = 'test pass';
                    return true;
                } else {
                    document.getElementById('data-result').textContent = 'WARN - No hive_state.json data, will use emergency fallback';
                    document.getElementById('data-test').className = 'test fail';
                    return false;
                }
            } catch (e) {
                document.getElementById('data-result').textContent = 'WARN - Data loading failed, will use fallback: ' + e.message;
                document.getElementById('data-test').className = 'test fail';
                return false;
            }
        }

        async function runTests() {
            log('Starting 3D Realm compatibility tests...');
            
            const webglPass = testWebGL();
            const threePass = testThreeJS();
            const canvasPass = testCanvas();
            const dataPass = await testData();
            
            log(`Results: WebGL=${webglPass}, Three.js=${threePass}, Canvas=${canvasPass}, Data=${dataPass}`);
            
            if (webglPass && threePass && canvasPass) {
                log('✅ 3D Realm should work on this browser');
            } else {
                log('❌ 3D Realm may have issues on this browser');
            }
        }

        // Run tests automatically on load
        window.addEventListener('load', () => {
            setTimeout(runTests, 100);
        });

        // Error handling
        window.addEventListener('error', (e) => {
            log('ERROR: ' + e.message);
        });
    </script>
</body>
</html>