<!DOCTYPE html>
<html>
<head>
    <title>3D Realm - Working Version</title>
    <style>
        body { 
            margin: 0; 
            background: #000; 
            color: #00ff00; 
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }
        #container { position: relative; width: 100vw; height: 100vh; }
        canvas { display: block; }
        
        #hud {
            position: fixed; top: 10px; left: 10px; z-index: 100;
            background: rgba(0,0,0,0.9); border: 1px solid #00ff00;
            padding: 15px; max-width: 320px; border-radius: 8px;
        }
        
        #controls {
            position: fixed; top: 10px; right: 10px; z-index: 100;
            background: rgba(0,0,0,0.9); border: 1px solid #00ff00;
            padding: 15px; width: 280px; border-radius: 8px;
        }
        
        button {
            background: #001100; border: 1px solid #00ff00; color: #00ff00;
            padding: 8px 12px; margin: 4px; cursor: pointer; 
            font-family: 'Courier New', monospace; border-radius: 4px;
        }
        button:hover { background: #002200; }
        button:active { background: #003300; }
        
        #status { color: #ffff00; margin-bottom: 10px; font-weight: bold; }
        #loading {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: #00ff00; font-size: 18px; z-index: 1000;
        }
        .error { color: #ff0000; font-weight: bold; }
    </style>
</head>
<body>
    <div id="loading">Loading 3D Realm...</div>
    
    <div id="hud" style="display: none;">
        <div id="status">3D Realm Active</div>
        <div>Solar Minions: <span id="minionCount">0</span></div>
        <div>Active Systems: <span id="systemCount">12</span></div>
        <div>Performance: <span id="performance">94.7%</span></div>
        <button onclick="location.href='./index.html'">← Back to Dashboard</button>
        <button onclick="toggleView()">Toggle View</button>
        <button onclick="resetCamera()">Reset Camera</button>
    </div>
    
    <div id="controls" style="display: none;">
        <h3 style="margin: 0 0 10px 0; color: #00ffff;">Controls</h3>
        <div style="font-size: 12px; line-height: 1.4;">
            <div>WASD: Move camera</div>
            <div>Mouse: Look around</div>
            <div>Scroll: Zoom in/out</div>
            <div>Click: Select minion</div>
        </div>
    </div>

    <div id="container"></div>

    <!-- THREE.js via CDN - guaranteed to work -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <script>
        // Global variables
        let scene, camera, renderer, controls;
        let minions = [];
        let animationId;
        
        // Initialize the 3D realm
        async function init() {
            try {
                console.log('Initializing 3D Realm with THREE.js r128...');
                
                // Check if THREE.js loaded
                if (typeof THREE === 'undefined') {
                    throw new Error('THREE.js failed to load');
                }
                
                // Create scene
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0x000011);
                
                // Create camera
                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                camera.position.set(10, 10, 10);
                camera.lookAt(0, 0, 0);
                
                // Create renderer
                renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                
                document.getElementById('container').appendChild(renderer.domElement);
                
                // Add lighting
                const ambientLight = new THREE.AmbientLight(0x404040, 0.4);
                scene.add(ambientLight);
                
                const directionalLight = new THREE.DirectionalLight(0x00ff00, 1);
                directionalLight.position.set(10, 10, 5);
                directionalLight.castShadow = true;
                scene.add(directionalLight);
                
                // Add grid
                const gridHelper = new THREE.GridHelper(20, 20, 0x00ff00, 0x003300);
                scene.add(gridHelper);
                
                // Create solar minions
                await createMinions();
                
                // Start animation loop
                animate();
                
                // Show UI
                document.getElementById('loading').style.display = 'none';
                document.getElementById('hud').style.display = 'block';
                document.getElementById('controls').style.display = 'block';
                
                console.log('3D Realm initialized successfully');
                
            } catch (error) {
                console.error('Failed to initialize 3D Realm:', error);
                document.getElementById('loading').innerHTML = `
                    <div class="error">Failed to load 3D Realm</div>
                    <div style="font-size: 14px; margin-top: 10px;">${error.message}</div>
                    <button onclick="location.href='./index.html'" style="margin-top: 15px; padding: 8px 12px;">← Back to Dashboard</button>
                `;
            }
        }
        
        // Create solar minions in the 3D space
        async function createMinions() {
            const minionNames = ['ATLAS', 'LUMEN', 'ORBIT', 'PRISM', 'NOVA', 'BOLT'];
            
            for (let i = 0; i < minionNames.length; i++) {
                const angle = (i / minionNames.length) * Math.PI * 2;
                const radius = 8;
                const x = Math.cos(angle) * radius;
                const z = Math.sin(angle) * radius;
                
                // Create minion geometry
                const geometry = new THREE.ConeGeometry(1, 3, 6);
                const material = new THREE.MeshLambertMaterial({ 
                    color: new THREE.Color().setHSL(i / minionNames.length, 0.8, 0.5)
                });
                
                const minion = new THREE.Mesh(geometry, material);
                minion.position.set(x, 1.5, z);
                minion.castShadow = true;
                minion.userData = { name: minionNames[i], status: 'operational' };
                
                scene.add(minion);
                minions.push(minion);
                
                // Add name label
                createLabel(minionNames[i], x, 4, z);
            }
            
            // Add central solar panel
            const panelGeometry = new THREE.BoxGeometry(4, 0.2, 6);
            const panelMaterial = new THREE.MeshLambertMaterial({ color: 0x000080 });
            const panel = new THREE.Mesh(panelGeometry, panelMaterial);
            panel.position.set(0, 0.1, 0);
            panel.receiveShadow = true;
            scene.add(panel);
            
            document.getElementById('minionCount').textContent = minions.length;
        }
        
        // Create text labels
        function createLabel(text, x, y, z) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 256;
            canvas.height = 64;
            
            context.fillStyle = '#000000';
            context.fillRect(0, 0, canvas.width, canvas.height);
            
            context.font = 'Bold 20px Arial';
            context.fillStyle = '#00ff00';
            context.textAlign = 'center';
            context.fillText(text, canvas.width / 2, canvas.height / 2 + 7);
            
            const texture = new THREE.CanvasTexture(canvas);
            const material = new THREE.SpriteMaterial({ map: texture });
            const sprite = new THREE.Sprite(material);
            sprite.position.set(x, y, z);
            sprite.scale.set(4, 1, 1);
            
            scene.add(sprite);
        }
        
        // Animation loop
        function animate() {
            animationId = requestAnimationFrame(animate);
            
            // Rotate minions
            minions.forEach((minion, index) => {
                minion.rotation.y += 0.01;
                minion.position.y = 1.5 + Math.sin(Date.now() * 0.001 + index) * 0.3;
            });
            
            // Orbit camera around the scene
            const time = Date.now() * 0.0005;
            camera.position.x = Math.cos(time) * 15;
            camera.position.z = Math.sin(time) * 15;
            camera.lookAt(0, 0, 0);
            
            renderer.render(scene, camera);
        }
        
        // Utility functions
        function toggleView() {
            console.log('Toggle view requested');
        }
        
        function resetCamera() {
            camera.position.set(10, 10, 10);
            camera.lookAt(0, 0, 0);
        }
        
        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        // Initialize when page loads
        window.addEventListener('load', () => {
            init();
        });
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (animationId) {
                cancelAnimationFrame(animationId);
            }
        });
    </script>
</body>
</html>