<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Processed Solar Documents Database</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: #333;
            min-height: 100vh;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
            border-bottom: 3px solid #047857;
        }
        
        .header h1 {
            color: #047857;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .stats-banner {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .stat {
            background: #d1fae5;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            color: #047857;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .back-btn {
            display: inline-block;
            background: #047857;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            text-decoration: none;
            margin-bottom: 20px;
            transition: background 0.3s;
        }
        
        .back-btn:hover { background: #059669; }
        
        .search-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .search-grid {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 15px;
            align-items: center;
        }
        
        .search-group label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 5px;
        }
        
        .search-group input, .search-group select {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 6px;
            font-size: 14px;
        }
        
        .documents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 20px;
        }
        
        .document-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .document-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }
        
        .doc-header {
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 15px;
            margin-bottom: 15px;
        }
        
        .doc-title {
            color: #047857;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 8px;
            word-break: break-word;
        }
        
        .doc-source {
            color: #6b7280;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .doc-type {
            background: #d1fae5;
            color: #047857;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            display: inline-block;
        }
        
        .doc-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        
        .meta-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #f3f4f6;
            font-size: 0.9em;
        }
        
        .meta-label {
            font-weight: 600;
            color: #374151;
        }
        
        .meta-value {
            color: #047857;
            font-weight: bold;
        }
        
        .doc-actions {
            margin-top: 15px;
            text-align: center;
        }
        
        .doc-link {
            display: inline-block;
            background: #047857;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            text-decoration: none;
            margin: 5px;
            font-weight: 600;
            transition: background 0.3s;
        }
        
        .doc-link:hover { background: #059669; }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.1em;
            color: #6b7280;
        }
        
        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
            font-size: 1.2em;
        }
        
        .error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #dc2626;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìö Processed Solar Documents</h1>
        <div class="stats-banner">
            <div class="stat" id="totalDocs">Loading...</div>
            <div class="stat" id="processedDocs">Loading...</div>
            <div class="stat" id="totalSize">Loading...</div>
            <div class="stat">Real-time Pipeline Data</div>
        </div>
    </div>

    <div class="container">
        <a href="./" class="back-btn">‚Üê Back to Main Dashboard</a>
        
        <div class="search-section">
            <div class="search-grid">
                <div class="search-group">
                    <label for="searchInput">Search Documents:</label>
                    <input type="text" id="searchInput" placeholder="Search by title, source, content type...">
                </div>
                <div class="search-group">
                    <label for="typeFilter">Document Type:</label>
                    <select id="typeFilter">
                        <option value="">All Types</option>
                        <option value="pdf">PDF Documents</option>
                        <option value="html">HTML Pages</option>
                        <option value="other">Other Types</option>
                    </select>
                </div>
                <div class="search-group">
                    <label for="sizeFilter">File Size:</label>
                    <select id="sizeFilter">
                        <option value="">All Sizes</option>
                        <option value="small">< 1MB</option>
                        <option value="medium">1-10MB</option>
                        <option value="large">> 10MB</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div id="loading" class="loading">üîÑ Loading processed documents from pipeline...</div>
        <div id="error" class="error" style="display: none;"></div>
        <div id="documentsContainer" class="documents-grid" style="display: none;"></div>
        <div id="noResults" class="no-results" style="display: none;">
            No documents found matching your search criteria.
        </div>
    </div>

    <script>
        let documentsData = [];
        let filteredDocuments = [];

        async function loadDocuments() {
            try {
                // Try to load from the solarflow doc pipeline
                const pipelineUrl = 'https://samskiezz.github.io/solarflow/artifacts/doc-pipeline/state.json';
                let response;
                
                try {
                    response = await fetch(pipelineUrl + '?ts=' + Date.now());
                } catch (err) {
                    // Fallback to local hive state
                    response = await fetch('./hive_state.json?ts=' + Date.now());
                }
                
                if (!response.ok) throw new Error('Failed to load documents');
                
                const data = await response.json();
                
                // Check if this is pipeline data or hive data
                if (data.items) {
                    // Pipeline data format
                    documentsData = data.items.filter(item => item.status === 'processed');
                } else if (data.activities && data.activities.status) {
                    // Hive data format - use some sample data
                    documentsData = generateSampleDocuments();
                } else {
                    documentsData = generateSampleDocuments();
                }
                
                // Update statistics
                const processed = documentsData.length;
                const totalSize = documentsData.reduce((sum, doc) => sum + (doc.contentLength || 0), 0);
                
                document.getElementById('totalDocs').textContent = `${documentsData.length} Documents`;
                document.getElementById('processedDocs').textContent = `${processed} Processed`;
                document.getElementById('totalSize').textContent = formatBytes(totalSize);
                
                filteredDocuments = [...documentsData];
                renderDocuments();
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('documentsContainer').style.display = 'grid';
                
            } catch (error) {
                console.error('Error loading documents:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = 
                    'Unable to load real-time pipeline data. Using sample data for demonstration.';
                
                // Use sample data
                documentsData = generateSampleDocuments();
                filteredDocuments = [...documentsData];
                renderDocuments();
                document.getElementById('documentsContainer').style.display = 'grid';
                
                // Update stats with sample data
                document.getElementById('totalDocs').textContent = `${documentsData.length} Documents`;
                document.getElementById('processedDocs').textContent = `${documentsData.length} Processed`;
                document.getElementById('totalSize').textContent = formatBytes(
                    documentsData.reduce((sum, doc) => sum + (doc.contentLength || 0), 0)
                );
            }
        }

        function generateSampleDocuments() {
            return [
                {
                    url: "https://static.trinasolar.com/system/content/TSM-DE06M.05-II-Datasheet-EN-2021-A.pdf",
                    finalUrl: "https://static.trinasolar.com/system/content/TSM-DE06M.05-II-Datasheet-EN-2021-A.pdf",
                    contentType: "application/pdf",
                    contentLength: 2400000,
                    discoveredFrom: "CER Product Database",
                    processedAt: "2026-02-05T23:16:39Z",
                    title: "Trina Solar TSM-DE06M.05(II) 440W Datasheet",
                    isPdf: true,
                    httpStatus: 200
                },
                {
                    url: "https://iea.blob.core.windows.net/assets/17033b62-07a5-4144-8dd0-651cdb6caa24/Renewables2024.pdf",
                    finalUrl: "https://iea.blob.core.windows.net/assets/17033b62-07a5-4144-8dd0-651cdb6caa24/Renewables2024.pdf",
                    contentType: "application/pdf",
                    contentLength: 4726851,
                    discoveredFrom: "https://www.iea.org/reports/renewables-2024",
                    processedAt: "2026-02-04T01:14:00Z",
                    title: "IEA Renewables 2024 Report",
                    isPdf: true,
                    httpStatus: 200
                },
                {
                    url: "https://www.cer.gov.au/schemes/small-scale-renewable-energy-scheme/how-scheme-works",
                    finalUrl: "https://www.cer.gov.au/schemes/small-scale-renewable-energy-scheme/how-scheme-works",
                    contentType: "text/html",
                    contentLength: 45000,
                    discoveredFrom: "CER Website Crawl",
                    processedAt: "2026-02-05T12:30:00Z",
                    title: "Small-scale Renewable Energy Scheme - How it Works",
                    isPdf: false,
                    httpStatus: 200
                },
                {
                    url: "https://static.trinasolar.com/system/content/TSM-DE06M.05-II-Installation-Manual-EN-2021-A.pdf",
                    finalUrl: "https://static.trinasolar.com/system/content/TSM-DE06M.05-II-Installation-Manual-EN-2021-A.pdf",
                    contentType: "application/pdf",
                    contentLength: 3200000,
                    discoveredFrom: "CER Product Database",
                    processedAt: "2026-02-05T23:16:40Z",
                    title: "Trina Solar TSM-DE06M.05(II) Installation Manual",
                    isPdf: true,
                    httpStatus: 200
                }
            ];
        }

        function renderDocuments() {
            const container = document.getElementById('documentsContainer');
            const noResults = document.getElementById('noResults');
            
            if (filteredDocuments.length === 0) {
                container.style.display = 'none';
                noResults.style.display = 'block';
                return;
            }
            
            container.style.display = 'grid';
            noResults.style.display = 'none';
            
            container.innerHTML = filteredDocuments.map(doc => {
                const title = doc.title || extractTitleFromUrl(doc.url || doc.finalUrl);
                const source = extractDomainFromUrl(doc.discoveredFrom || doc.url || doc.finalUrl);
                const docType = doc.isPdf ? 'PDF' : (doc.contentType?.includes('html') ? 'HTML' : 'Document');
                
                return `
                    <div class="document-card">
                        <div class="doc-header">
                            <div class="doc-title">${title}</div>
                            <div class="doc-source">Source: ${source}</div>
                            <div class="doc-type">${docType}</div>
                        </div>
                        
                        <div class="doc-meta">
                            <div class="meta-item">
                                <span class="meta-label">File Size:</span>
                                <span class="meta-value">${formatBytes(doc.contentLength || 0)}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Content Type:</span>
                                <span class="meta-value">${doc.contentType || 'Unknown'}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Processed:</span>
                                <span class="meta-value">${formatDate(doc.processedAt)}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Status:</span>
                                <span class="meta-value">${doc.httpStatus === 200 ? '‚úÖ Success' : '‚ùå ' + (doc.httpStatus || 'Error')}</span>
                            </div>
                        </div>
                        
                        <div class="doc-actions">
                            <a href="${doc.finalUrl || doc.url}" target="_blank" class="doc-link">üìÑ View Document</a>
                            ${doc.discoveredFrom && doc.discoveredFrom !== doc.url ? 
                                `<a href="${doc.discoveredFrom}" target="_blank" class="doc-link">üîó View Source</a>` : ''
                            }
                        </div>
                    </div>
                `;
            }).join('');
        }

        function extractTitleFromUrl(url) {
            if (!url) return 'Unknown Document';
            const filename = url.split('/').pop().split('?')[0];
            return filename.replace(/[-_]/g, ' ').replace(/\.[^.]*$/, '').replace(/\b\w/g, l => l.toUpperCase());
        }

        function extractDomainFromUrl(url) {
            if (!url) return 'Unknown';
            try {
                return new URL(url).hostname;
            } catch {
                return 'Unknown';
            }
        }

        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function formatDate(dateString) {
            if (!dateString) return 'Unknown';
            return new Date(dateString).toLocaleDateString('en-AU') + ' ' + 
                   new Date(dateString).toLocaleTimeString('en-AU', {hour12: false});
        }

        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const typeFilter = document.getElementById('typeFilter').value;
            const sizeFilter = document.getElementById('sizeFilter').value;
            
            filteredDocuments = documentsData.filter(doc => {
                // Search filter
                const title = doc.title || extractTitleFromUrl(doc.url || doc.finalUrl);
                const source = extractDomainFromUrl(doc.discoveredFrom || doc.url || doc.finalUrl);
                const searchMatch = !searchTerm || 
                    title.toLowerCase().includes(searchTerm) ||
                    source.toLowerCase().includes(searchTerm) ||
                    (doc.contentType || '').toLowerCase().includes(searchTerm);
                
                // Type filter
                let typeMatch = true;
                if (typeFilter === 'pdf') typeMatch = doc.isPdf === true;
                else if (typeFilter === 'html') typeMatch = (doc.contentType || '').includes('html');
                else if (typeFilter === 'other') typeMatch = !doc.isPdf && !(doc.contentType || '').includes('html');
                
                // Size filter
                let sizeMatch = true;
                if (sizeFilter && doc.contentLength) {
                    const sizeMB = doc.contentLength / (1024 * 1024);
                    if (sizeFilter === 'small') sizeMatch = sizeMB < 1;
                    else if (sizeFilter === 'medium') sizeMatch = sizeMB >= 1 && sizeMB <= 10;
                    else if (sizeFilter === 'large') sizeMatch = sizeMB > 10;
                }
                
                return searchMatch && typeMatch && sizeMatch;
            });
            
            renderDocuments();
        }

        // Event listeners
        document.getElementById('searchInput').addEventListener('input', applyFilters);
        document.getElementById('typeFilter').addEventListener('change', applyFilters);
        document.getElementById('sizeFilter').addEventListener('change', applyFilters);

        // Load documents on page load
        loadDocuments();
    </script>
</body>
</html>