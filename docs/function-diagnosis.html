<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SolarFlow Function Diagnosis</title>
    <style>
        body { 
            font-family: monospace; 
            background: #0a0a0a; 
            color: #00ff88; 
            padding: 20px; 
            line-height: 1.4;
        }
        .test-result { 
            margin: 5px 0; 
            padding: 8px; 
            border-left: 3px solid; 
        }
        .pass { border-color: #00ff88; background: rgba(0, 255, 136, 0.1); }
        .fail { border-color: #ff4444; background: rgba(255, 68, 68, 0.1); color: #ff8888; }
        .warn { border-color: #ffaa00; background: rgba(255, 170, 0, 0.1); color: #ffcc88; }
        button { 
            background: #333; 
            color: #00ff88; 
            border: 1px solid #555; 
            padding: 10px 15px; 
            margin: 5px; 
            cursor: pointer; 
            border-radius: 4px;
        }
        button:hover { background: #555; }
        .section { 
            margin: 20px 0; 
            border: 1px solid #333; 
            padding: 15px; 
            border-radius: 8px; 
        }
        .code { 
            background: #111; 
            padding: 10px; 
            border-radius: 4px; 
            margin: 10px 0; 
            white-space: pre-wrap; 
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>üîç SolarFlow Function Diagnosis</h1>
    <p>Comprehensive analysis of all UI functions and their working status</p>
    
    <button onclick="runFullDiagnosis()">üîç Run Full Diagnosis</button>
    <button onclick="testButtonFunctions()">üîò Test Button Functions</button>
    <button onclick="testScriptLoading()">üì¶ Test Script Loading</button>
    <button onclick="clearResults()">üßπ Clear Results</button>
    
    <div id="results"></div>
    
    <script>
        let results = [];
        
        function log(message, type = 'info') {
            results.push({message, type, timestamp: new Date().toLocaleTimeString()});
            updateDisplay();
        }
        
        function updateDisplay() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = results.map(r => {
                const className = r.type === 'pass' ? 'pass' : r.type === 'fail' ? 'fail' : r.type === 'warn' ? 'warn' : '';
                return `<div class="test-result ${className}">[${r.timestamp}] ${r.message}</div>`;
            }).join('');
        }
        
        function clearResults() {
            results = [];
            updateDisplay();
        }
        
        function runFullDiagnosis() {
            clearResults();
            log('üîç Starting comprehensive function diagnosis...', 'info');
            
            testScriptLoading();
            testGlobalVariables();
            testButtonFunctions();
            testFileAccess();
            testUIElements();
            
            log('‚úÖ Diagnosis complete!', 'pass');
        }
        
        function testScriptLoading() {
            log('üì¶ Testing script loading...', 'info');
            
            // Test if universal function fix loaded
            if (typeof window.UNIFIED_REAL_SYSTEM !== 'undefined') {
                log('‚úÖ UNIFIED_REAL_SYSTEM loaded', 'pass');
            } else {
                log('‚ùå UNIFIED_REAL_SYSTEM not loaded', 'fail');
            }
            
            if (typeof window.UNIVERSAL_FUNCTION_FIX !== 'undefined') {
                log('‚úÖ UNIVERSAL_FUNCTION_FIX loaded', 'pass');
            } else {
                log('‚ùå UNIVERSAL_FUNCTION_FIX not loaded', 'fail');
            }
            
            // Test for other key scripts
            const scripts = document.querySelectorAll('script[src]');
            log(`üì¶ Found ${scripts.length} external scripts`, 'info');
            
            scripts.forEach(script => {
                const src = script.src;
                const name = src.split('/').pop();
                if (name.includes('function-fix') || name.includes('unified')) {
                    try {
                        // Check if script actually executed
                        if (script.onload) {
                            log(`‚úÖ Script loaded: ${name}`, 'pass');
                        } else {
                            log(`‚ö†Ô∏è Script may not have executed: ${name}`, 'warn');
                        }
                    } catch (error) {
                        log(`‚ùå Script error: ${name} - ${error.message}`, 'fail');
                    }
                }
            });
        }
        
        function testGlobalVariables() {
            log('üåê Testing global variables...', 'info');
            
            const expectedGlobals = [
                'UNIFIED_REAL_SYSTEM',
                'UNIVERSAL_FUNCTION_FIX',
                'setPaused',
                'paused'
            ];
            
            expectedGlobals.forEach(varName => {
                if (window[varName] !== undefined) {
                    log(`‚úÖ Global variable exists: ${varName}`, 'pass');
                } else {
                    log(`‚ùå Global variable missing: ${varName}`, 'fail');
                }
            });
        }
        
        function testButtonFunctions() {
            log('üîò Testing button functions...', 'info');
            
            // Test main buttons
            const mainButtons = [
                { selector: 'button[onclick*="realm.html"]', name: '3D Realm Button' },
                { selector: 'a[href*="comprehensive-function-test.html"]', name: 'Function Test Link' },
                { selector: 'a[onclick*="btnToggle"]', name: 'Pause/Resume Button' },
                { selector: 'a[onclick*="location.reload"]', name: 'Refresh Button' }
            ];
            
            mainButtons.forEach(btn => {
                const element = document.querySelector(btn.selector);
                if (element) {
                    log(`‚úÖ Button found: ${btn.name}`, 'pass');
                    
                    // Test if onclick function is valid
                    const onclick = element.getAttribute('onclick');
                    if (onclick) {
                        try {
                            // Test if the function would execute (without actually executing)
                            new Function(onclick.replace('return false', ''));
                            log(`‚úÖ Button function valid: ${btn.name}`, 'pass');
                        } catch (error) {
                            log(`‚ùå Button function invalid: ${btn.name} - ${error.message}`, 'fail');
                        }
                    }
                } else {
                    log(`‚ùå Button not found: ${btn.name}`, 'fail');
                }
            });
            
            // Test dropdown buttons
            const dropdowns = document.querySelectorAll('.dropdown');
            log(`üîΩ Found ${dropdowns.length} dropdown menus`, 'info');
            
            dropdowns.forEach((dropdown, index) => {
                const links = dropdown.querySelectorAll('.dropdown-content a');
                log(`üîΩ Dropdown ${index + 1} has ${links.length} links`, 'info');
                
                links.forEach(link => {
                    const href = link.getAttribute('href');
                    const text = link.textContent.trim();
                    if (href && href !== '#') {
                        log(`‚úÖ Dropdown link: ${text} ‚Üí ${href}`, 'pass');
                    } else {
                        log(`‚ùå Broken dropdown link: ${text}`, 'fail');
                    }
                });
            });
        }
        
        function testFileAccess() {
            log('üìÑ Testing file access...', 'info');
            
            const criticalFiles = [
                'hive_state.json',
                'real-cer-product-database.json',
                'realm.html',
                'comprehensive-function-test.html'
            ];
            
            criticalFiles.forEach(async (filename) => {
                try {
                    const response = await fetch(`./${filename}`);
                    if (response.ok) {
                        log(`‚úÖ File accessible: ${filename}`, 'pass');
                    } else {
                        log(`‚ùå File not accessible: ${filename} (${response.status})`, 'fail');
                    }
                } catch (error) {
                    log(`‚ùå File access error: ${filename} - ${error.message}`, 'fail');
                }
            });
        }
        
        function testUIElements() {
            log('üñ•Ô∏è Testing UI elements...', 'info');
            
            // Test if key UI elements exist and are functional
            const uiElements = [
                { selector: '#btnToggle', name: 'Pause/Resume Toggle' },
                { selector: '.meters', name: 'Metrics Display' },
                { selector: '.feed', name: 'Activity Feed' },
                { selector: '.rosterGrid', name: 'Minion Roster Grid' },
                { selector: '.pillbar', name: 'Status Pills' }
            ];
            
            uiElements.forEach(element => {
                const el = document.querySelector(element.selector);
                if (el) {
                    log(`‚úÖ UI element found: ${element.name}`, 'pass');
                    
                    // Test if element has content
                    if (el.children.length > 0 || el.textContent.trim().length > 0) {
                        log(`‚úÖ UI element has content: ${element.name}`, 'pass');
                    } else {
                        log(`‚ö†Ô∏è UI element empty: ${element.name}`, 'warn');
                    }
                } else {
                    log(`‚ùå UI element not found: ${element.name}`, 'fail');
                }
            });
            
            // Test data loading
            setTimeout(() => {
                if (window.minions && window.minions.length > 0) {
                    log(`‚úÖ Minion data loaded: ${window.minions.length} minions`, 'pass');
                } else {
                    log(`‚ùå Minion data not loaded`, 'fail');
                }
            }, 2000);
        }
        
        // Auto-run diagnosis on page load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                log('üöÄ Auto-diagnosis starting...', 'info');
                runFullDiagnosis();
            }, 1000);
        });
    </script>
</body>
</html>